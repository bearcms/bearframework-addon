<?php

/*
 * Bear CMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) Amplilabs Ltd.
 * Free to use under the MIT license.
 */

return <<<'EOT'
var bearCMS=bearCMS||{};bearCMS.sliderElements=bearCMS.sliderElements||function(){var e=ivoPetkov.bearFrameworkAddons.touchEvents,t=[],r=[],n=function(e,t,n){for(var i=!1,a=0;a<r.length;a++){var o=r[a];if(o[0]===e){o[1][t]=n,i=!0;break}}if(!i){var l={};l[t]=n,r.push([e,l])}},i=function(e,t){for(var n=0;n<r.length;n++){var i=r[n];if(i[0]===e)return void 0!==i[1][t]?i[1][t]:null}return null},a=function(e){return e.querySelector("[data-bearcms-slider-button-previous]")},o=function(e){return e.querySelector("[data-bearcms-slider-button-next]")},l=function(e,t){t?e.setAttribute("data-bearcms-slider-button-visible","1"):e.removeAttribute("data-bearcms-slider-button-visible")},d=function(e,t){t?e.removeAttribute("data-bearcms-slider-no-transition"):e.setAttribute("data-bearcms-slider-no-transition","")},s=function(e){return"1"===e.getAttribute("data-rvr-editable")},u=function(e,t){if(null!==t&&null!==e)for(var r=t.parentNode;null!==r;){if(r===e)return!0;r=r.parentNode}return!1},c=function(e){var t=e.getBoundingClientRect();return{width:t.width,height:t.height}},f=function(e){for(var t=[],r=s(e),n=e.firstChild.childNodes,i=0;i<n.length;i++){var a=n[i];(r||0!==a.childNodes.length)&&t.push(a)}return t},v=function(e){var t=e.querySelector("[data-bearcms-slider-indicators]"),r=f(e).length,n="";if(r>1)for(var i=0;i<r;i++)n+="<span data-bearcms-slider-indicator></span>";if(t.innerHTML=n,r>1)for(i=0;i<r;i++)!function(r){t.childNodes[r].addEventListener("click",(function(){y(e,r)}))}(i)},h=function(e){for(var t=i(e,"index"),r=e.querySelector("[data-bearcms-slider-indicators]").childNodes,n=0;n<r.length;n++)if(void 0!==r[n]){var a=r[n];n===t?a.setAttribute("data-bearcms-slider-indicator-selected",""):a.removeAttribute("data-bearcms-slider-indicator-selected")}},b=function(e){var t=e.getAttribute("data-bearcms-slider-direction"),r=e.getAttribute("data-bearcms-slider-autoplay");if(s(e)){var d=e.firstChild.childNodes,b=d.length,m=d[b-1];m.childNodes.length>0&&(m.parentNode.insertAdjacentHTML("beforeend","<div></div>"),v(e));for(var g=function(){var t=e.firstChild.childNodes,r=t.length;if(r>=2){var n=t[r-1],i=t[r-2];if(0===n.childNodes.length&&0===i.childNodes.length)return n.parentNode.removeChild(n),v(e),!0}return!1},y=0;y<b&&g();y++);}var A=f(e),C=A.length,N=i(e,"index"),E=a(e),P=o(e);l(E,N>0),l(P,N+1<C);var S,L=0,q=0,k=[0];if(("horizontal"===t||"vertical"===t)&&C>0){var M=0,z=0,I=c(e.firstChild);for(y=0;y<C;y++){var F=A[y],O=c(F);if(y<N&&(L+=O.width,q+=O.height),y>0)for(var R=y;R<C;R++)void 0===k[R]&&(k[R]=0),k[R]+=O.height;M+=O.width,z+=O.height}var T=I.width,V=I.height;T+L>M&&(L+=M-(T+L)),V+q>z&&(q+=z-(V+q))}for(y=0;y<C;y++){F=A[y],O=c(F);var B="0px",H="0px",X="1",Y=!0;"horizontal"===t?N>0&&(B="-"+L+"px"):"vertical"===t?(y>0&&(B="-"+100*y+"%"),H=k[y]-q+"px"):"swap"===t&&(y>0&&(B="-"+100*y+"%"),y!==N&&(X="0",Y=!1)),F.style.setProperty("--bse-slide-x",B),F.style.setProperty("--bse-slide-y",H),F.style.setProperty("opacity",X),F.style.setProperty("pointer-events",Y?"auto":"none")}if(i(e,"autoplayValue")!==r&&(w(e),n(e,"autoplayValue",r),null!==r)){var j=(S=r).indexOf("ms")?1e3*parseInt(S.replace("ms","")):S.indexOf("s")?1e3*parseInt(S.replace("s",""))*1e3:null;if(null!==j){var D=window.setInterval((function(){p(e)||function(e){var t=e.getBoundingClientRect();if(0===t.width&&0===t.height)return!1;for(var r=getComputedStyle(e),n=function(e){return parseInt(r.getPropertyValue("border-"+e+"-width").replace("px",""))},i=t.left+1+n("left"),a=t.right-1+n("right"),o=t.top+1+n("top"),l=t.bottom-1+n("bottom"),d=[[i,o],[a,o],[i,l],[a,l]],s=0;s<d.length;s++){var c=d[s],f=document.elementFromPoint(c[0],c[1]);if(f===e||u(e,f))return!0}return!1}(e)&&x(e,1)}),j);n(e,"autoplayInterval",D)}}h(e)},p=function(e){return null!==i(e,"autoplayPaused")},m=function(e){n(e,"autoplayPaused",1)},g=function(e){n(e,"autoplayPaused",null)},w=function(e){window.clearInterval(i(e,"autoplayInterval"))},y=function(e,t){n(e,"index",t),b(e)},x=function(e,t){if(0!==t){var r=i(e,"index");r+=t;var n=f(e).length;r<0?r=0:r>n-1&&(r=n-1),y(e,r)}},A=function(e,t,r){e.style.setProperty("--bse-swipe-x",t),e.style.setProperty("--bse-swipe-y",r)},C=function(r){if(void 0!==r)var l=[r];else l=document.querySelectorAll(".bearcms-slider-element");for(var s=0;s<l.length;s++){r=l[s];-1===t.indexOf(r)&&(!function(t){var r=a(t),l=o(t);r.addEventListener("click",(function(){x(t,-1)})),l.addEventListener("click",(function(){x(t,1)})),t.addEventListener("mouseenter",(function(){m(t)})),t.addEventListener("mouseleave",(function(){g(t)})),n(t,"index",0),v(t),h(t),new MutationObserver((function(){b(t),v(t),h(t)})).observe(t,{attributeFilter:["data-rvr-editable"]});var s=e.addSwipe(t.firstChild,t.ownerDocument.body);s.addEventListener("start",(function(e){if(A(t,"0px","0px"),null!==t.getAttribute("data-bearcms-slider-swipe")){var r=t.getAttribute("data-bearcms-slider-direction");"horizontal"!==r&&"vertical"!==r||d(t,!1)}})),s.addEventListener("change",(function(e){if(null!==t.getAttribute("data-bearcms-slider-swipe")){var r=t.getAttribute("data-bearcms-slider-direction");"horizontal"===r?A(t,e.changeX+"px","0px"):"vertical"===r&&A(t,"0px",e.changeY+"px")}})),s.addEventListener("end",(function(e){if(null!==t.getAttribute("data-bearcms-slider-swipe")){d(t,!0),A(t,"0px","0px");var r=t.getAttribute("data-bearcms-slider-direction"),n=null;if("horizontal"===r||"swap"===r?n=e.changeX:"vertical"===r&&(n=e.changeY),null!==n){var a=Math.abs(n);if(a>40){var o=n<0;if("swap"===r)x(t,o?1:-1);else{var l=i(t,"index"),s=f(t),u=s.length,v=0,h=null,b=[];if(o)for(var p=l;p<u;p++)b.push(p);else for(p=l;p>=0;p--)b.push(p);for(p=0;p<b.length;p++){var m=b[p],g=s[m],w=c(g),y="horizontal"===r?w.width:w.height;if(v+(o?0:y)>=a){h=m+(o?0:-1);break}v+=y}null===h&&(h=o?u-1:0),x(t,h-l)}}}}})),d(t,!0)}(r),t.push(r)),b(r)}};document.addEventListener("readystatechange",(function(){C()})),"complete"===document.readyState&&C();var N=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},E=!1;return{update:C,queueUpdate:function(){E||(E=!0,N((function(){E=!1,C()})))}}}();
EOT;