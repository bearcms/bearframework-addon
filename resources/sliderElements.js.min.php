<?php

/*
 * Bear CMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) Amplilabs Ltd.
 * Free to use under the MIT license.
 */

return <<<'EOT'
var bearCMS=bearCMS||{};bearCMS.sliderElements=bearCMS.sliderElements||function(){var e=ivoPetkov.bearFrameworkAddons.touchEvents,t=[],n=[],r=function(e,t,r){for(var i=!1,a=0;a<n.length;a++){var o=n[a];if(o[0]===e){o[1][t]=r,i=!0;break}}if(!i){var l={};l[t]=r,n.push([e,l])}},i=function(e,t){for(var r=0;r<n.length;r++){var i=n[r];if(i[0]===e)return void 0!==i[1][t]?i[1][t]:null}return null},a=function(e){return e.querySelector("[data-bearcms-slider-button-previous]")},o=function(e){return e.querySelector("[data-bearcms-slider-button-next]")},l=function(e,t){t?e.setAttribute("data-bearcms-slider-button-visible","1"):e.removeAttribute("data-bearcms-slider-button-visible")},s=function(e,t){t?e.removeAttribute("data-bearcms-slider-no-transition"):e.setAttribute("data-bearcms-slider-no-transition","")},d=function(e){return"1"===e.getAttribute("data-rvr-editable")},u=function(e,t){if(null!==t&&null!==e)for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1},f=function(e){var t=e.getBoundingClientRect();return{width:t.width,height:t.height}},c=function(e){return e.firstChild.childNodes},v=function(e){for(var t=[],n=d(e),r=c(e),i=0;i<r.length;i++){var a=r[i];(n||0!==a.childNodes.length)&&t.push(a)}return t},h=function(e){var t=e.querySelector("[data-bearcms-slider-indicators]"),n=v(e).length,r="";if(n>1)for(var i=0;i<n;i++)r+="<span data-bearcms-slider-indicator></span>";if(t.innerHTML=r,n>1)for(i=0;i<n;i++)!function(n){t.childNodes[n].addEventListener("click",(function(){m(e,null,n),P(e,n)}))}(i)},p=function(e){for(var t=i(e,"index"),n=e.querySelector("[data-bearcms-slider-indicators]").childNodes,r=0;r<n.length;r++)if(void 0!==n[r]){var a=n[r];r===t?a.setAttribute("data-bearcms-slider-indicator-selected",""):a.removeAttribute("data-bearcms-slider-indicator-selected")}},b=function(e){return e.getAttribute("data-bearcms-slider-direction")},x=function(e){return null!==e.getAttribute("data-bearcms-slider-infinite")},m=function(e,t,n){null===t&&(t=i(e,"index"));var a=null;if(x(e)&&"horizontal"===b(e)){a={firstIndexes:[],lastIndexes:[],indexes:[],offsets:[]};for(var o=v(e),l=o.length,s=l-1,d=f(e.firstChild).width,u=0,c=[],h=0;h<l;h++)c[h]=f(o[h]).width,u+=c[h];if(3*d<=u&&l>=3){var p=0;for(h=0;h<l&&(a.offsets[h]=d+"px",a.firstIndexes.push(h),!((p+=c[h])>=d));h++);for(p=0,h=s;h>=0&&(a.offsets[h]=-u+"px",a.lastIndexes.push(h),!((p+=c[h])>=d));h--);s===n&&n>t?a.indexes=a.firstIndexes:0===n&&n<t&&(a.indexes=a.lastIndexes)}}r(e,"infiniteSlidesData",a)},g=function(e){var t=b(e),n=function(e){return e.getAttribute("data-bearcms-slider-autoplay")}(e),s=x(e),m=s?i(e,"infiniteSlidesData"):null;if(d(e)){var g=c(e),w=g.length,A=g[w-1];A.childNodes.length>0&&(A.parentNode.insertAdjacentHTML("beforeend","<div></div>"),h(e));for(var P=function(){var t=c(e),n=t.length;if(n>=2){var r=t[n-1],i=t[n-2];if(0===r.childNodes.length&&0===i.childNodes.length)return r.parentNode.removeChild(r),h(e),!0}return!1},O=0;O<w&&P();O++);}var C=v(e),E=C.length,L=i(e,"index"),N=a(e),q=o(e);l(N,!!s||L>0),l(q,!!s||L+1<E);var k=0,z=0,M=[0],F=0;if(("horizontal"===t||"vertical"===t)&&E>0){var V=0,R=0,D=f(e.firstChild);for(O=0;O<E;O++){var T=C[O],B=f(T);if(O<L&&(k+=B.width,z+=B.height),O>0)for(var H=O;H<E;H++)void 0===M[H]&&(M[H]=0),M[H]+=B.height;V+=B.width,R+=B.height,F=B.width}var X=D.width,Y=D.height;X+k>V&&(k+=V-(X+k)),Y+z>R&&(z+=R-(Y+z))}var j,U=function(e){return-1!==e.indexOf("calc(")};for(O=0;O<E;O++){T=C[O],B=f(T);var G="0px",J="0px",K="1",Q=!0;"horizontal"===t?(L>0&&(G="-"+k+"px"),null!==m&&-1!==m.indexes.indexOf(O)&&(G="calc("+m.offsets[O]+" + 0px)")):"vertical"===t?(O>0&&(G="-"+100*O+"%"),J=M[O]-z+"px"):"swap"===t&&(O>0&&(G="-"+100*O+"%"),O!==L&&(K="0",Q=!1));var W=T.style.getPropertyValue("--bse-slide-x"),Z=function(e){window.getComputedStyle(e).getPropertyValue("transition")},$=!1;if(null!==m){var _=E-1,ee=m.indexes;-1!==ee.indexOf(0)?-1!==ee.indexOf(O)?U(W)||"0px"===W||($=!0):-1===m.firstIndexes.indexOf(O)&&-1===m.lastIndexes.indexOf(O)&&"0px"===W&&($=!0):-1!==ee.indexOf(_)?-1!==ee.indexOf(O)?!U(G)||W!=="-"+F+"px"&&""!==W||($=!0):-1===m.firstIndexes.indexOf(O)&&-1===m.lastIndexes.indexOf(O)&&W!=="-"+X+"px"&&($=!0):0===ee.length&&U(W)&&($=!0)}$&&(T.style.setProperty("transition","none","important"),Z(T)),T.style.setProperty("--bse-slide-x",G),T.style.setProperty("--bse-slide-y",J),T.style.setProperty("opacity",K),T.style.setProperty("pointer-events",Q?"auto":"none"),$&&(Z(T),T.style.removeProperty("transition"),Z(T))}if(i(e,"autoplayValue")!==n&&(I(e),r(e,"autoplayValue",n),null!==n)){var te=(j=n).indexOf("ms")?1e3*parseInt(j.replace("ms","")):j.indexOf("s")?1e3*parseInt(j.replace("s",""))*1e3:null;if(null!==te){var ne=window.setInterval((function(){y(e)||function(e){var t=e.getBoundingClientRect();if(0===t.width&&0===t.height)return!1;for(var n=getComputedStyle(e),r=function(e){return parseInt(n.getPropertyValue("border-"+e+"-width").replace("px",""))},i=t.left+1+r("left"),a=t.right-1+r("right"),o=t.top+1+r("top"),l=t.bottom-1+r("bottom"),s=[[i,o],[a,o],[i,l],[a,l],[(a-i)/2+i,(l-o)/2+o],[(a-i)/2+i,o],[(a-i)/2+i,l],[i,(l-o)/2+o],[a,(l-o)/2+o]],d=0;d<s.length;d++){var f=s[d],c=document.elementFromPoint(f[0],f[1]);if(c===e||u(e,c))return!0}return!1}(e)&&S(e,1)}),te);r(e,"autoplayInterval",ne)}}p(e)},y=function(e){return null!==i(e,"autoplayPaused")},w=function(e){r(e,"autoplayPaused",1)},A=function(e){r(e,"autoplayPaused",null)},I=function(e){window.clearInterval(i(e,"autoplayInterval"))},P=function(e,t){r(e,"index",t),g(e)},S=function(e,t){if(0!==t){var n=x(e),r=i(e,"index"),a=r+t,o=v(e).length;a<0?a=n?o-1:0:a>o-1&&(a=n?0:o-1),m(e,r,a),P(e,a)}},O=function(e,t,n){e.style.setProperty("--bse-swipe-x",t),e.style.setProperty("--bse-swipe-y",n)},C=function(n){if(void 0!==n)var l=[n];else l=document.querySelectorAll(".bearcms-slider-element");for(var d=0;d<l.length;d++){n=l[d];-1===t.indexOf(n)&&(!function(t){var n=a(t),l=o(t);n.addEventListener("click",(function(){S(t,-1)})),l.addEventListener("click",(function(){S(t,1)})),t.addEventListener("mouseenter",(function(){w(t)})),t.addEventListener("mouseleave",(function(){A(t)}));var d=!1;t.addEventListener("touchstart",(function(){d||(d=!0,w(t))})),r(t,"index",0),h(t),p(t),m(t,1,0),new MutationObserver((function(){g(t),h(t),p(t)})).observe(t,{attributeFilter:["data-rvr-editable"]});var u=e.addSwipe(t.firstChild,t.ownerDocument.body);u.addEventListener("start",(function(e){if(O(t,"0px","0px"),null!==t.getAttribute("data-bearcms-slider-swipe")){var n=b(t);"horizontal"!==n&&"vertical"!==n||s(t,!1)}})),u.addEventListener("change",(function(e){if(null!==t.getAttribute("data-bearcms-slider-swipe")){var n=b(t);"horizontal"===n?O(t,e.changeX+"px","0px"):"vertical"===n&&O(t,"0px",e.changeY+"px")}})),u.addEventListener("end",(function(e){if(null!==t.getAttribute("data-bearcms-slider-swipe")){s(t,!0),O(t,"0px","0px");var n=b(t),r=null;if("horizontal"===n||"swap"===n?r=e.changeX:"vertical"===n&&(r=e.changeY),null!==r){var a=Math.abs(r);if(a>40){var o=r<0;if("swap"===n)S(t,o?1:-1);else{var l=x(t),d=i(t,"index"),u=v(t),c=u.length,h=0,p=null,m=[];if(o)for(var g=d;g<c;g++)m.push(g);else for(g=d;g>=0;g--)m.push(g);for(g=0;g<m.length;g++){var y=m[g],w=u[y],A=f(w),I="horizontal"===n?A.width:A.height;if(h+(o?0:I)>=a){p=y+(o?0:-1);break}h+=I}null===p&&(p=o?c-1:0),l&&p===d&&(p=o?0:c-1),S(t,p-d)}}}}})),s(t,!0)}(n),t.push(n)),g(n)}};document.addEventListener("readystatechange",(function(){C()})),"complete"===document.readyState&&C();var E=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},L=!1;return{update:C,queueUpdate:function(){L||(L=!0,E((function(){L=!1,C()})))}}}();
EOT;