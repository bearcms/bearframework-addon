<?php

/*
 * Bear CMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) Amplilabs Ltd.
 * Free to use under the MIT license.
 */

return <<<'EOT'
var bearCMS=bearCMS||{};bearCMS.sliderElements=bearCMS.sliderElements||function(){var e=ivoPetkov.bearFrameworkAddons.touchEvents,t=[],n=[],r=function(e,t,r){for(var i=!1,a=0;a<n.length;a++){var o=n[a];if(o[0]===e){o[1][t]=r,i=!0;break}}if(!i){var l={};l[t]=r,n.push([e,l])}},i=function(e,t){for(var r=0;r<n.length;r++){var i=n[r];if(i[0]===e)return void 0!==i[1][t]?i[1][t]:null}return null},a=function(e){return e.querySelector("[data-bearcms-slider-button-previous]")},o=function(e){return e.querySelector("[data-bearcms-slider-button-next]")},l=function(e,t){t?e.setAttribute("data-bearcms-slider-button-visible","1"):e.removeAttribute("data-bearcms-slider-button-visible")},s=function(e,t){t?e.removeAttribute("data-bearcms-slider-no-transition"):e.setAttribute("data-bearcms-slider-no-transition","")},d=function(e){return"1"===e.getAttribute("data-rvr-editable")},u=function(e,t){if(null!==t&&null!==e)for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1},f=function(e,t){void 0===t&&(t=!1);var n=e.getBoundingClientRect();if(t){var r=window.getComputedStyle(e);return{width:n.width+parseInt(r.marginLeft)+parseInt(r.marginRight),height:n.height+parseInt(r.marginTop)+parseInt(r.marginBottom)}}return{width:n.width,height:n.height}},c=function(e){return e.firstChild.childNodes},v=function(e){for(var t=[],n=d(e),r=c(e),i=0;i<r.length;i++){var a=r[i];(n||0!==a.childNodes.length)&&t.push(a)}return t},h=function(e){var t=e.querySelector("[data-bearcms-slider-indicators]"),n=v(e).length,r="";if(n>1)for(var i=0;i<n;i++)r+="<span data-bearcms-slider-indicator></span>";if(t.innerHTML=r,n>1)for(i=0;i<n;i++)!function(n){t.childNodes[n].addEventListener("click",(function(){x(e,null,n),C(e,n)}))}(i)},p=function(e){var t=i(e,"index"),n=e.querySelector("[data-bearcms-slider-indicators]");m(e)?n.style.display="none":n.style.removeProperty("display");for(var r=n.childNodes,a=0;a<r.length;a++)if(void 0!==r[a]){var o=r[a];a===t?o.setAttribute("data-bearcms-slider-indicator-selected",""):o.removeAttribute("data-bearcms-slider-indicator-selected")}},g=function(e){return e.getAttribute("data-bearcms-slider-direction")},b=function(e){return null!==e.getAttribute("data-bearcms-slider-infinite")},m=function(e){var t=g(e);if("horizontal"===t||"vertical"===t){for(var n=f(e.firstChild),r=0,i=v(e),a=i.length,o=0;o<a;o++){var l=f(i[o],!0);r+="horizontal"===t?l.width:l.height}return"horizontal"===t?r<n.width:r<n.height}return!1},x=function(e,t,n){null===t&&(t=i(e,"index"));var a=null;if(b(e)&&"horizontal"===g(e)){a={firstIndexes:[],lastIndexes:[],indexes:[],offsets:[]};for(var o=v(e),l=o.length,s=l-1,d=f(e.firstChild).width,u=0,c=[],h=0;h<l;h++)c[h]=f(o[h],!0).width,u+=c[h];if(3*d<=u&&l>=3){var p=0;for(h=0;h<l&&(a.offsets[h]=d+"px",a.firstIndexes.push(h),!((p+=c[h])>=d));h++);for(p=0,h=s;h>=0&&(a.offsets[h]=-u+"px",a.lastIndexes.push(h),!((p+=c[h])>=d));h--);s===n&&n>t?a.indexes=a.firstIndexes:0===n&&n<t&&(a.indexes=a.lastIndexes)}}r(e,"infiniteSlidesData",a)},y=function(e){var t=g(e),n=function(e){return e.getAttribute("data-bearcms-slider-autoplay")}(e),s=b(e),x=s?i(e,"infiniteSlidesData"):null;if(d(e)){var y=c(e),I=y.length,A=I>0?y[I-1]:null;(null===A||A.childNodes.length>0)&&(e.firstChild.insertAdjacentHTML("beforeend","<div></div>"),h(e));for(var C=function(){var t=c(e),n=t.length;if(n>=2){var r=t[n-1],i=t[n-2];if(0===r.childNodes.length&&0===i.childNodes.length)return r.parentNode.removeChild(r),h(e),!0}return!1},E=0;E<I&&C();E++);}var L=v(e),O=L.length,z=i(e,"index"),N=a(e),q=o(e);l(N,!!s||z>0),l(q,!!s||z+1<O);var k=m(e);k?N.style.display="none":N.style.removeProperty("display"),k?q.style.display="none":q.style.removeProperty("display");var M=0,F=0,R=[0],V=0;if(("horizontal"===t||"vertical"===t)&&O>0){var T=0,B=0,D=f(e.firstChild);for(E=0;E<O;E++){var H=L[E],X=f(H,!0);if(E<z&&(M+=X.width,F+=X.height),E>0)for(var Y=E;Y<O;Y++)void 0===R[Y]&&(R[Y]=0),R[Y]+=X.height;T+=X.width,B+=X.height,V=X.width}var j=D.width,U=D.height;j+M>T&&(M+=T-(j+M)),U+F>B&&(F+=B-(U+F))}var G,J=function(e){return-1!==e.indexOf("calc(")};for(E=0;E<O;E++){H=L[E],X=f(H,!0);var K="0px",Q="0px",W="1",Z=!0;"horizontal"===t?(z>0&&(K="-"+M+"px"),null!==x&&-1!==x.indexes.indexOf(E)&&(K="calc("+x.offsets[E]+" + 0px)")):"vertical"===t?(E>0&&(K="-"+100*E+"%"),Q=R[E]-F+"px"):"swap"===t&&(E>0&&(K="-"+100*E+"%"),E!==z&&(W="0",Z=!1));var $=H.style.getPropertyValue("--bse-slide-x"),_=function(e){window.getComputedStyle(e).getPropertyValue("transition")},ee=!1;if(null!==x){var te=O-1,ne=x.indexes;-1!==ne.indexOf(0)?-1!==ne.indexOf(E)?J($)||"0px"===$||(ee=!0):-1===x.firstIndexes.indexOf(E)&&-1===x.lastIndexes.indexOf(E)&&"0px"===$&&(ee=!0):-1!==ne.indexOf(te)?-1!==ne.indexOf(E)?!J(K)||$!=="-"+V+"px"&&""!==$||(ee=!0):-1===x.firstIndexes.indexOf(E)&&-1===x.lastIndexes.indexOf(E)&&$!=="-"+j+"px"&&(ee=!0):0===ne.length&&J($)&&(ee=!0)}ee&&(H.style.setProperty("transition","none","important"),_(H)),H.style.setProperty("--bse-slide-x",K),H.style.setProperty("--bse-slide-y",Q),H.style.setProperty("opacity",W),H.style.setProperty("pointer-events",Z?"auto":"none"),ee&&(_(H),H.style.removeProperty("transition"),_(H))}if(i(e,"autoplayValue")!==n&&(P(e),r(e,"autoplayValue",n),null!==n)){var re=(G=n).indexOf("ms")?1e3*parseInt(G.replace("ms","")):G.indexOf("s")?1e3*parseInt(G.replace("s",""))*1e3:null;if(null!==re){var ie=window.setInterval((function(){w(e)||function(e){var t=e.getBoundingClientRect();if(0===t.width&&0===t.height)return!1;for(var n=getComputedStyle(e),r=function(e){return parseInt(n.getPropertyValue("border-"+e+"-width").replace("px",""))},i=t.left+1+r("left"),a=t.right-1+r("right"),o=t.top+1+r("top"),l=t.bottom-1+r("bottom"),s=[[i,o],[a,o],[i,l],[a,l],[(a-i)/2+i,(l-o)/2+o],[(a-i)/2+i,o],[(a-i)/2+i,l],[i,(l-o)/2+o],[a,(l-o)/2+o]],d=0;d<s.length;d++){var f=s[d],c=document.elementFromPoint(f[0],f[1]);if(c===e||u(e,c))return!0}return!1}(e)&&S(e,1)}),re);r(e,"autoplayInterval",ie)}}p(e)},w=function(e){return null!==i(e,"autoplayPaused")},I=function(e){r(e,"autoplayPaused",1)},A=function(e){r(e,"autoplayPaused",null)},P=function(e){window.clearInterval(i(e,"autoplayInterval"))},C=function(e,t){r(e,"index",t),y(e)},S=function(e,t){if(0!==t){var n=b(e),r=i(e,"index"),a=r+t,o=v(e).length;a<0?a=n?o-1:0:a>o-1&&(a=n?0:o-1),x(e,r,a),C(e,a)}},E=function(e,t,n){e.style.setProperty("--bse-swipe-x",t),e.style.setProperty("--bse-swipe-y",n)},L=function(n){if(void 0!==n)var l=[n];else l=document.querySelectorAll(".bearcms-slider-element");for(var d=0;d<l.length;d++){n=l[d];-1===t.indexOf(n)&&(!function(t){var n=a(t),l=o(t);n.addEventListener("click",(function(){S(t,-1)})),l.addEventListener("click",(function(){S(t,1)})),t.addEventListener("mouseenter",(function(){I(t)})),t.addEventListener("mouseleave",(function(){A(t)}));var d=!1;t.addEventListener("touchstart",(function(){d||(d=!0,I(t))})),r(t,"index",0),h(t),p(t),x(t,1,0),new MutationObserver((function(){y(t),h(t),p(t)})).observe(t,{attributeFilter:["data-rvr-editable"]});var u=e.addSwipe(t.firstChild,t.ownerDocument.body);u.addEventListener("start",(function(e){if(E(t,"0px","0px"),null!==t.getAttribute("data-bearcms-slider-swipe")&&!m(t)){var n=g(t);"horizontal"!==n&&"vertical"!==n||s(t,!1)}})),u.addEventListener("change",(function(e){if(null!==t.getAttribute("data-bearcms-slider-swipe")&&!m(t)){var n=g(t);"horizontal"===n?E(t,e.changeX+"px","0px"):"vertical"===n&&E(t,"0px",e.changeY+"px")}})),u.addEventListener("end",(function(e){if(null!==t.getAttribute("data-bearcms-slider-swipe")&&!m(t)){s(t,!0),E(t,"0px","0px");var n=g(t),r=null;if("horizontal"===n||"swap"===n?r=e.changeX:"vertical"===n&&(r=e.changeY),null!==r){var a=Math.abs(r);if(a>40){var o=r<0;if("swap"===n)S(t,o?1:-1);else{var l=b(t),d=i(t,"index"),u=v(t),c=u.length,h=0,p=null,x=[];if(o)for(var y=d;y<c;y++)x.push(y);else for(y=d;y>=0;y--)x.push(y);for(y=0;y<x.length;y++){var w=x[y],I=u[w],A=f(I,!0),P="horizontal"===n?A.width:A.height;if(h+(o?0:P)>=a){p=w+(o?0:-1);break}h+=P}null===p&&(p=o?c-1:0),l&&p===d&&(p=o?0:c-1),S(t,p-d)}}}}})),s(t,!0)}(n),t.push(n)),y(n)}};document.addEventListener("readystatechange",(function(){L()})),window.addEventListener("resize",(function(){N()})),"complete"===document.readyState&&L();var O=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},z=!1,N=function(){z||(z=!0,O((function(){z=!1,L()})))};return{update:L,queueUpdate:N}}();
EOT;