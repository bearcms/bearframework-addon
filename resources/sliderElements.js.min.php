<?php

/*
 * Bear CMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) Amplilabs Ltd.
 * Free to use under the MIT license.
 */

return <<<'EOT'
var bearCMS=bearCMS||{};bearCMS.sliderElements=bearCMS.sliderElements||function(){var e=ivoPetkov.bearFrameworkAddons.touchEvents,t=[],n=[],r=function(e,t,r){for(var i=!1,a=0;a<n.length;a++){var o=n[a];if(o[0]===e){o[1][t]=r,i=!0;break}}if(!i){var l={};l[t]=r,n.push([e,l])}},i=function(e,t){for(var r=0;r<n.length;r++){var i=n[r];if(i[0]===e)return void 0!==i[1][t]?i[1][t]:null}return null},a=function(e){return e.querySelector("[data-bearcms-slider-button-previous]")},o=function(e){return e.querySelector("[data-bearcms-slider-button-next]")},l=function(e,t){t?e.setAttribute("data-bearcms-slider-button-visible","1"):e.removeAttribute("data-bearcms-slider-button-visible")},d=function(e){return-1!==e.indexOf("ms")?parseInt(e.replace("ms","")):-1!==e.indexOf("s")?1e3*parseInt(e.replace("s","")):null},s=function(e,t){t?e.removeAttribute("data-bearcms-slider-no-transition"):e.setAttribute("data-bearcms-slider-no-transition","")},u=function(e){return"1"===e.getAttribute("data-rvr-editable")},f=function(e,t){if(null!==t&&null!==e)for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1},c=function(e,t){void 0===t&&(t=!1);var n=e.getBoundingClientRect();if(t){var r=window.getComputedStyle(e);return{width:n.width+parseInt(r.marginLeft)+parseInt(r.marginRight),height:n.height+parseInt(r.marginTop)+parseInt(r.marginBottom)}}return{width:n.width,height:n.height}},v=function(e){return e.firstChild.childNodes},h=function(e){for(var t=[],n=u(e),r=v(e),i=0;i<r.length;i++){var a=r[i];(n||0!==a.childNodes.length)&&t.push(a)}return t},p=function(e){var t=e.querySelector("[data-bearcms-slider-indicators]"),n=h(e).length,r="";if(n>1)for(var i=0;i<n;i++)r+="<span data-bearcms-slider-indicator></span>";if(t.innerHTML=r,n>1)for(i=0;i<n;i++)!function(n){t.childNodes[n].addEventListener("click",(function(){y(e,null,n),C(e,n)}))}(i)},g=function(e){var t=i(e,"index"),n=e.querySelector("[data-bearcms-slider-indicators]");x(e)?n.style.display="none":n.style.removeProperty("display");for(var r=n.childNodes,a=0;a<r.length;a++)if(void 0!==r[a]){var o=r[a];a===t?o.setAttribute("data-bearcms-slider-indicator-selected",""):o.removeAttribute("data-bearcms-slider-indicator-selected")}},m=function(e){return e.getAttribute("data-bearcms-slider-direction")},b=function(e){return null!==e.getAttribute("data-bearcms-slider-infinite")},x=function(e){var t=m(e);if("horizontal"===t||"vertical"===t){for(var n=c(e.firstChild),r=0,i=h(e),a=i.length,o=0;o<a;o++){var l=c(i[o],!0);r+="horizontal"===t?l.width:l.height}return"horizontal"===t?r<n.width:r<n.height}return!1},y=function(e,t,n){null===t&&(t=i(e,"index"));var a=null;if(b(e)&&"horizontal"===m(e)){a={firstIndexes:[],lastIndexes:[],indexes:[],offsets:[]};for(var o=h(e),l=o.length,d=l-1,s=c(e.firstChild).width,u=0,f=[],v=0;v<l;v++)f[v]=c(o[v],!0).width,u+=f[v];if(3*s<=u&&l>=3){var p=0;for(v=0;v<l&&(a.offsets[v]=s+"px",a.firstIndexes.push(v),!((p+=f[v])>=s));v++);for(p=0,v=d;v>=0&&(a.offsets[v]=-u+"px",a.lastIndexes.push(v),!((p+=f[v])>=s));v--);d===n&&n>t?a.indexes=a.firstIndexes:0===n&&n<t&&(a.indexes=a.lastIndexes)}}r(e,"infiniteSlidesData",a)},w=function(e){var t=m(e),n=function(e){return e.getAttribute("data-bearcms-slider-autoplay")}(e),s=b(e),y=s?i(e,"infiniteSlidesData"):null;if(u(e)){var w=v(e),S=w.length,P=S>0?w[S-1]:null;(null===P||P.childNodes.length>0)&&(e.firstChild.insertAdjacentHTML("beforeend","<div></div>"),p(e));for(var C=function(){var t=v(e),n=t.length;if(n>=2){var r=t[n-1],i=t[n-2];if(0===r.childNodes.length&&0===i.childNodes.length)return r.parentNode.removeChild(r),p(e),!0}return!1},L=0;L<S&&C();L++);}var O=h(e),z=O.length,N=i(e,"index"),q=a(e),k=o(e);l(q,!!s||N>0),l(k,!!s||N+1<z);var M=x(e);M?q.style.display="none":q.style.removeProperty("display"),M?k.style.display="none":k.style.removeProperty("display");var T=0,V=0,F=[0],R=0;if(("horizontal"===t||"vertical"===t)&&z>0){var B=0,D=0,H=c(e.firstChild);for(L=0;L<z;L++){var X=O[L],Y=c(X,!0);if(L<N&&(T+=Y.width,V+=Y.height),L>0)for(var j=L;j<z;j++)void 0===F[j]&&(F[j]=0),F[j]+=Y.height;B+=Y.width,D+=Y.height,R=Y.width}var U=H.width,G=H.height;U+T>B&&(T+=B-(U+T)),G+V>D&&(V+=D-(G+V))}var J=function(e){return-1!==e.indexOf("calc(")};for(L=0;L<z;L++){X=O[L],Y=c(X,!0);var K="0px",Q="0px",W="1",Z=!0;"horizontal"===t?(N>0&&(K="-"+T+"px"),null!==y&&-1!==y.indexes.indexOf(L)&&(K="calc("+y.offsets[L]+" + 0px)")):"vertical"===t?(L>0&&(K="-"+100*L+"%"),Q=F[L]-V+"px"):"swap"===t&&(L>0&&(K="-"+100*L+"%"),L!==N&&(W="0",Z=!1));var $=X.style.getPropertyValue("--bse-slide-x"),_=function(e){window.getComputedStyle(e).getPropertyValue("transition")},ee=!1;if(null!==y){var te=z-1,ne=y.indexes;-1!==ne.indexOf(0)?-1!==ne.indexOf(L)?J($)||"0px"===$||(ee=!0):-1===y.firstIndexes.indexOf(L)&&-1===y.lastIndexes.indexOf(L)&&"0px"===$&&(ee=!0):-1!==ne.indexOf(te)?-1!==ne.indexOf(L)?!J(K)||$!=="-"+R+"px"&&""!==$||(ee=!0):-1===y.firstIndexes.indexOf(L)&&-1===y.lastIndexes.indexOf(L)&&$!=="-"+U+"px"&&(ee=!0):0===ne.length&&J($)&&(ee=!0)}ee&&(X.style.setProperty("transition","none","important"),_(X)),X.style.setProperty("--bse-slide-x",K),X.style.setProperty("--bse-slide-y",Q),X.style.setProperty("opacity",W),X.style.setProperty("pointer-events",Z?"auto":"none"),ee&&(_(X),X.style.removeProperty("transition"),_(X))}if(i(e,"autoplayValue")!==n&&(A(e),r(e,"autoplayValue",n),null!==n)){var re=d(n);if(null!==re){var ie=window.setInterval((function(){I(e)||function(e){var t=e.getBoundingClientRect();if(0===t.width&&0===t.height)return!1;for(var n=getComputedStyle(e),r=function(e){return parseInt(n.getPropertyValue("border-"+e+"-width").replace("px",""))},i=t.left+1+r("left"),a=t.right-1+r("right"),o=t.top+1+r("top"),l=t.bottom-1+r("bottom"),d=[[i,o],[a,o],[i,l],[a,l],[(a-i)/2+i,(l-o)/2+o],[(a-i)/2+i,o],[(a-i)/2+i,l],[i,(l-o)/2+o],[a,(l-o)/2+o]],s=0;s<d.length;s++){var u=d[s],c=document.elementFromPoint(u[0],u[1]);if(c===e||f(e,c))return!0}return!1}(e)&&E(e,1)}),re);r(e,"autoplayInterval",ie)}}g(e)},I=function(e){return null!==i(e,"autoplayPaused")},S=function(e){r(e,"autoplayPaused",1)},P=function(e){r(e,"autoplayPaused",null)},A=function(e){window.clearInterval(i(e,"autoplayInterval"))},C=function(e,t,n){if(i(e,"index")!==t){r(e,"index",t),w(e);var a=void 0!==(n=void 0!==n?n:{}).onShowSlide?n.onShowSlide:null;if(null!==a){var o=N(e);null!==o?setTimeout(a,o):a()}}},E=function(e,t){if(0!==t){var n=b(e),r=i(e,"index"),a=r+t,o=h(e).length;a<0?a=n?o-1:0:a>o-1&&(a=n?0:o-1),y(e,r,a),C(e,a)}},L=function(e,t,n){e.style.setProperty("--bse-swipe-x",t),e.style.setProperty("--bse-swipe-y",n)},O=function(e,t,n){for(var r=v(e),i=0;i<r.length;i++)for(var a=r[i].childNodes,o=0;o<a.length;o++)if(a[o]===t)return void C(e,i,n)},z=function(e,t){var n=i(e,"index"),r=v(e);if(void 0!==r[n])for(var a=r[n].childNodes,o=0;o<a.length;o++)if(a[o]===t)return!0;return!1},N=function(e){var t=getComputedStyle(e).getPropertyValue("--bearcms-slider-element-speed");return""!==t?d(t):null},q=function(n){if(void 0!==n)var l=[n];else l=document.querySelectorAll(".bearcms-slider-element");for(var d=0;d<l.length;d++){n=l[d];-1===t.indexOf(n)&&(!function(t){var n=a(t),l=o(t);n.addEventListener("click",(function(){E(t,-1)})),l.addEventListener("click",(function(){E(t,1)})),t.addEventListener("mouseenter",(function(){S(t)})),t.addEventListener("mouseleave",(function(){P(t)}));var d=!1;t.addEventListener("touchstart",(function(){d||(d=!0,S(t))})),r(t,"index",0),p(t),g(t),y(t,1,0),t.slideTo=function(e){C(t,e)},t.slideToElement=function(e,n){O(t,e,n)},t.isInVisibleSlide=function(e){return z(t,e)},new MutationObserver((function(){w(t),p(t),g(t)})).observe(t,{attributeFilter:["data-rvr-editable"]});var u=e.addSwipe(t.firstChild,t.ownerDocument.body);u.addEventListener("start",(function(e){if(L(t,"0px","0px"),null!==t.getAttribute("data-bearcms-slider-swipe")&&!x(t)){var n=m(t);"horizontal"!==n&&"vertical"!==n||s(t,!1)}})),u.addEventListener("change",(function(e){if(null!==t.getAttribute("data-bearcms-slider-swipe")&&!x(t)){var n=m(t);"horizontal"===n?L(t,e.changeX+"px","0px"):"vertical"===n&&L(t,"0px",e.changeY+"px")}})),u.addEventListener("end",(function(e){if(null!==t.getAttribute("data-bearcms-slider-swipe")&&!x(t)){s(t,!0),L(t,"0px","0px");var n=m(t),r=null;if("horizontal"===n||"swap"===n?r=e.changeX:"vertical"===n&&(r=e.changeY),null!==r){var a=Math.abs(r);if(a>40){var o=r<0;if("swap"===n)E(t,o?1:-1);else{var l=b(t),d=i(t,"index"),u=h(t),f=u.length,v=0,p=null,g=[];if(o)for(var y=d;y<f;y++)g.push(y);else for(y=d;y>=0;y--)g.push(y);for(y=0;y<g.length;y++){var w=g[y],I=u[w],S=c(I,!0),P="horizontal"===n?S.width:S.height;if(v+(o?0:P)>=a){p=w+(o?0:-1);break}v+=P}null===p&&(p=o?f-1:0),l&&p===d&&(p=o?0:f-1),E(t,p-d)}}}}})),s(t,!0)}(n),t.push(n)),w(n)}};document.addEventListener("readystatechange",(function(){q()})),window.addEventListener("resize",(function(){T()})),"complete"===document.readyState&&q();var k=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},M=!1,T=function(){M||(M=!0,k((function(){M=!1,q()})))};return{update:q,queueUpdate:T}}();
EOT;