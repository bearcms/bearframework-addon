<?php

/*
 * Bear CMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) Amplilabs Ltd.
 * Free to use under the MIT license.
 */

return <<<'EOT'
var bearCMS=bearCMS||{};bearCMS.sliderElements=bearCMS.sliderElements||function(){var e=ivoPetkov.bearFrameworkAddons.touchEvents,t=[],n=[],r=function(e,t,r){for(var i=!1,a=0;a<n.length;a++){var o=n[a];if(o[0]===e){o[1][t]=r,i=!0;break}}if(!i){var l={};l[t]=r,n.push([e,l])}},i=function(e,t){for(var r=0;r<n.length;r++){var i=n[r];if(i[0]===e)return void 0!==i[1][t]?i[1][t]:null}return null},a=function(e){return e.querySelector("[data-bearcms-slider-button-previous]")},o=function(e){return e.querySelector("[data-bearcms-slider-button-next]")},l=function(e,t){t?e.setAttribute("data-bearcms-slider-button-visible","1"):e.removeAttribute("data-bearcms-slider-button-visible")},d=function(e){return-1!==e.indexOf("ms")?parseInt(e.replace("ms","")):-1!==e.indexOf("s")?1e3*parseInt(e.replace("s","")):null},s=function(e,t){t?e.removeAttribute("data-bearcms-slider-no-transition"):e.setAttribute("data-bearcms-slider-no-transition","")},u=function(e){return"1"===e.getAttribute("data-rvr-editable")},f=function(e,t){if(null!==t&&null!==e)for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1},c=function(e,t){void 0===t&&(t=!1);var n=e.getBoundingClientRect();if(t){var r=window.getComputedStyle(e);return{width:n.width+parseInt(r.marginLeft)+parseInt(r.marginRight),height:n.height+parseInt(r.marginTop)+parseInt(r.marginBottom)}}return{width:n.width,height:n.height}},v=function(e){return e.firstChild.childNodes},h=function(e){for(var t=[],n=u(e),r=v(e),i=0;i<r.length;i++){var a=r[i];(n||0!==a.childNodes.length)&&t.push(a)}return t},p=function(e){var t=e.querySelector("[data-bearcms-slider-indicators]"),n=h(e).length,r="";if(n>1)for(var i=0;i<n;i++)r+="<span data-bearcms-slider-indicator></span>";if(t.innerHTML=r,n>1)for(i=0;i<n;i++)(function(n){t.childNodes[n].addEventListener("click",function(){x(e,null,n),E(e,n)})})(i)},g=function(e){var t=i(e,"index"),n=e.querySelector("[data-bearcms-slider-indicators]");b(e)?n.style.display="none":n.style.removeProperty("display");for(var r=n.childNodes,a=0;a<r.length;a++)if(void 0!==r[a]){var o=r[a];a===t?o.setAttribute("data-bearcms-slider-indicator-selected",""):o.removeAttribute("data-bearcms-slider-indicator-selected")}},m=function(e){return e.getAttribute("data-bearcms-slider-direction")},y=function(e){return null!==e.getAttribute("data-bearcms-slider-infinite")},b=function(e){var t=m(e);if("horizontal"===t||"vertical"===t){for(var n=c(e.firstChild),r=0,i=h(e),a=i.length,o=0;o<a;o++){var l=c(i[o],!0);r+="horizontal"===t?l.width:l.height}return"horizontal"===t?r<n.width:r<n.height}return!1},x=function(e,t,n){null===t&&(t=i(e,"index"));var a=null;if(y(e)&&"horizontal"===m(e)){a={firstIndexes:[],lastIndexes:[],indexes:[],offsets:[]};for(var o=h(e),l=o.length,d=l-1,s=c(e.firstChild).width,u=0,f=[],v=0;v<l;v++)f[v]=c(o[v],!0).width,u+=f[v];if(3*s<=u&&l>=3){var p=0;for(v=0;v<l&&(a.offsets[v]=s+"px",a.firstIndexes.push(v),!((p+=f[v])>=s));v++);for(p=0,v=d;v>=0&&(a.offsets[v]=-u+"px",a.lastIndexes.push(v),!((p+=f[v])>=s));v--);d===n&&n>t?a.indexes=a.firstIndexes:0===n&&n<t&&(a.indexes=a.lastIndexes)}}r(e,"infiniteSlidesData",a)},w=function(e){var t=m(e),n=function(e){return e.getAttribute("data-bearcms-slider-autoplay")}(e),s=y(e),x=s?i(e,"infiniteSlidesData"):null;if(u(e)){var w=v(e),I=w.length,P=I>0?w[I-1]:null;(null===P||P.childNodes.length>0)&&(e.firstChild.insertAdjacentHTML("beforeend","<div></div>"),p(e));for(var C=function(){var t=v(e),n=t.length;if(n>=2){var r=t[n-1],i=t[n-2];if(0===r.childNodes.length&&0===i.childNodes.length)return r.parentNode.removeChild(r),p(e),!0}return!1},E=0;E<I&&C();E++);}var z=h(e),O=z.length,N=i(e,"index"),q=a(e),k=o(e);l(q,!!s||N>0),l(k,!!s||N+1<O);var M=b(e);M?q.style.display="none":q.style.removeProperty("display"),M?k.style.display="none":k.style.removeProperty("display");var T=0,V=0,F=[0],R=0;if(("horizontal"===t||"vertical"===t)&&O>0){var B=0,D=0,H=c(e.firstChild);for(E=0;E<O;E++){var X=z[E],Y=c(X,!0);if(E<N&&(T+=Y.width,V+=Y.height),E>0)for(var j=E;j<O;j++)void 0===F[j]&&(F[j]=0),F[j]+=Y.height;B+=Y.width,D+=Y.height,R=Y.width}var U=H.width,G=H.height;U+T>B&&(T+=B-(U+T)),G+V>D&&(V+=D-(G+V))}var J=function(e){return-1!==e.indexOf("calc(")};for(E=0;E<O;E++){X=z[E],Y=c(X,!0);var K="0px",Q="0px",W="1",Z=!0;"horizontal"===t?(N>0&&(K="-"+T+"px"),null!==x&&-1!==x.indexes.indexOf(E)&&(K="calc("+x.offsets[E]+" + 0px)")):"vertical"===t?(E>0&&(K="-"+100*E+"%"),Q=F[E]-V+"px"):"swap"===t&&(E>0&&(K="-"+100*E+"%"),E!==N&&(W="0",Z=!1));var $=X.style.getPropertyValue("--bse-slide-x"),_=function(e){window.getComputedStyle(e).getPropertyValue("transition")},ee=!1;if(null!==x){var te=O-1,ne=x.indexes;-1!==ne.indexOf(0)?-1!==ne.indexOf(E)?J($)||"0px"===$||(ee=!0):-1===x.firstIndexes.indexOf(E)&&-1===x.lastIndexes.indexOf(E)&&"0px"===$&&(ee=!0):-1!==ne.indexOf(te)?-1!==ne.indexOf(E)?!J(K)||$!=="-"+R+"px"&&""!==$||(ee=!0):-1===x.firstIndexes.indexOf(E)&&-1===x.lastIndexes.indexOf(E)&&$!=="-"+U+"px"&&(ee=!0):0===ne.length&&J($)&&(ee=!0)}ee&&(X.style.setProperty("transition","none","important"),_(X)),X.style.setProperty("--bse-slide-x",K),X.style.setProperty("--bse-slide-y",Q),X.style.setProperty("opacity",W),X.style.setProperty("pointer-events",Z?"auto":"none"),ee&&(_(X),X.style.removeProperty("transition"),_(X))}if(i(e,"autoplayValue")!==n&&(A(e),r(e,"autoplayValue",n),null!==n)){var re=d(n);if(null!==re){var ie=window.setInterval(function(){S(e)||function(e){var t=e.getBoundingClientRect();if(0===t.width&&0===t.height)return!1;for(var n=getComputedStyle(e),r=function(e){return parseInt(n.getPropertyValue("border-"+e+"-width").replace("px",""))},i=t.left+1+r("left"),a=t.right-1+r("right"),o=t.top+1+r("top"),l=t.bottom-1+r("bottom"),d=[[i,o],[a,o],[i,l],[a,l],[(a-i)/2+i,(l-o)/2+o],[(a-i)/2+i,o],[(a-i)/2+i,l],[i,(l-o)/2+o],[a,(l-o)/2+o]],s=0;s<d.length;s++){var u=d[s],c=document.elementFromPoint(u[0],u[1]);if(c===e||f(e,c))return!0}return!1}(e)&&L(e,1)},re);r(e,"autoplayInterval",ie)}}g(e)},S=function(e){return null!==i(e,"autoplayPaused")},I=function(e){r(e,"autoplayPaused",1)},P=function(e){r(e,"autoplayPaused",null)},A=function(e){window.clearInterval(i(e,"autoplayInterval"))},C=function(e,t){var n=v(e);if(void 0!==n[t])try{var r=n[t];if(void 0!==r){var i=r.querySelector("[data-responsively-lazy]");null!==i&&responsivelyLazy.run(i,{ignoreThreshold:!0})}}catch(e){}},E=function(e,t,n){if(i(e,"index")!==t){r(e,"index",t),w(e);var a=void 0!==(n=void 0!==n?n:{}).onShowSlide?n.onShowSlide:null;if(null!==a){var o=q(e);null!==o?setTimeout(a,o):a()}C(e,t-1),C(e,t),C(e,t+1)}},L=function(e,t){if(0!==t){var n=y(e),r=i(e,"index"),a=r+t,o=h(e).length;a<0?a=n?o-1:0:a>o-1&&(a=n?0:o-1),x(e,r,a),E(e,a)}},z=function(e,t,n){e.style.setProperty("--bse-swipe-x",t),e.style.setProperty("--bse-swipe-y",n)},O=function(e,t,n){for(var r=v(e),i=0;i<r.length;i++)for(var a=r[i].childNodes,o=0;o<a.length;o++)if(a[o]===t)return void E(e,i,n)},N=function(e,t){var n=i(e,"index"),r=v(e);if(void 0!==r[n])for(var a=r[n].childNodes,o=0;o<a.length;o++)if(a[o]===t)return!0;return!1},q=function(e){var t=getComputedStyle(e).getPropertyValue("--bearcms-slider-element-speed");return""!==t?d(t):null},k=function(n){if(void 0!==n)var l=[n];else l=document.querySelectorAll(".bearcms-slider-element");for(var d=0;d<l.length;d++){n=l[d];-1===t.indexOf(n)&&(function(t){var n=a(t),l=o(t);n.addEventListener("click",function(){L(t,-1)}),l.addEventListener("click",function(){L(t,1)}),t.addEventListener("mouseenter",function(){I(t)}),t.addEventListener("mouseleave",function(){P(t)});var d=!1;t.addEventListener("touchstart",function(){d||(d=!0,I(t))}),r(t,"index",0),p(t),g(t),x(t,1,0),t.slideTo=function(e){E(t,e)},t.slideToElement=function(e,n){O(t,e,n)},t.isInVisibleSlide=function(e){return N(t,e)},new MutationObserver(function(){w(t),p(t),g(t)}).observe(t,{attributeFilter:["data-rvr-editable"]});var u=e.addSwipe(t.firstChild,t.ownerDocument.body);u.addEventListener("start",function(e){if(z(t,"0px","0px"),null!==t.getAttribute("data-bearcms-slider-swipe")&&!b(t)){var n=m(t);"horizontal"!==n&&"vertical"!==n||s(t,!1)}}),u.addEventListener("change",function(e){if(null!==t.getAttribute("data-bearcms-slider-swipe")&&!b(t)){var n=m(t);"horizontal"===n?z(t,e.changeX+"px","0px"):"vertical"===n&&z(t,"0px",e.changeY+"px")}}),u.addEventListener("end",function(e){if(null!==t.getAttribute("data-bearcms-slider-swipe")&&!b(t)){s(t,!0),z(t,"0px","0px");var n=m(t),r=null;if("horizontal"===n||"swap"===n?r=e.changeX:"vertical"===n&&(r=e.changeY),null!==r){var a=Math.abs(r);if(a>40){var o=r<0;if("swap"===n)L(t,o?1:-1);else{var l=y(t),d=i(t,"index"),u=h(t),f=u.length,v=0,p=null,g=[];if(o)for(var x=d;x<f;x++)g.push(x);else for(x=d;x>=0;x--)g.push(x);for(x=0;x<g.length;x++){var w=g[x],S=u[w],I=c(S,!0),P="horizontal"===n?I.width:I.height;if(v+(o?0:P)>=a){p=w+(o?0:-1);break}v+=P}null===p&&(p=o?f-1:0),l&&p===d&&(p=o?0:f-1),L(t,p-d)}}}}}),s(t,!0)}(n),t.push(n)),w(n)}};document.addEventListener("readystatechange",function(){k()}),window.addEventListener("resize",function(){V()}),"complete"===document.readyState&&k();var M=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},T=!1,V=function(){T||(T=!0,M(function(){T=!1,k()}))};return{update:k,queueUpdate:V}}();
EOT;