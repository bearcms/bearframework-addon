<?php

/*
 * Bear CMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) Amplilabs Ltd.
 * Free to use under the MIT license.
 */

return <<<'EOT'
var bearCMS=bearCMS||{};bearCMS.commentsElementForm=bearCMS.commentsElementForm||function(){var e=[],t=function(t){var r="ur"+t;if(void 0===e[r]){e[r]=1;var c=document.getElementById(t);clientPackages.get("users").then((function(e){e.currentUser.addEventListener("change",(function(){n(t,null)}))})),c.addEventListener("beforesubmit",o),c.addEventListener("submitsuccess",i)}},n=function(e,t){var n=function(t){var n=document.getElementById(e),o=n.querySelector("textarea");t?(o.removeAttribute("readonly"),o.style.cursor="auto",o.removeEventListener("click",r),n.querySelector('[data-form-element-type="submit-button"]').style.removeProperty("display")):(o.setAttribute("readonly",!0),o.style.cursor="pointer",o.addEventListener("click",r),n.querySelector('[data-form-element-type="submit-button"]').style.display="none")};null!==t?n(t):clientPackages.get("users").then((function(e){e.currentUser.exists().then((function(e){n(e)}))}))},r=function(e){clientPackages.get("lightbox").then((function(n){n.make();var r=e.target.closest("form").id;clientPackages.get("users").then((function(e){t(r),e.openLogin()}))}))},o=function(e){var t=e.target,n=t.previousSibling;t.querySelector('[name="cfcontext"]').value=JSON.stringify({listElementID:n.id,listCommentsCount:n.getAttribute("data-count")})},i=function(e){var t=e.target,n=e.result;void 0!==n.success&&(t.querySelector('[name="cfcomment"]').value="",clientPackages.get("html5DOMDocument").then((function(e){var t=document.getElementById(n.listElementID);e.insert(n.listContent,[t,"outerHTML"])})))};return{initialize:function(e,r){n(e,r),r&&t(e)}}}();
EOT;
